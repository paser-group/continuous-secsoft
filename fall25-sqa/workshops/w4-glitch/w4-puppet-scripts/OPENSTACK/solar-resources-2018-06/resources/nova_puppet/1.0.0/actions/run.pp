$resource = hiera($::resource_name)

$db_user = $resource['input']['db_user']
$db_password = $resource['input']['db_password']
$db_name = $resource['input']['db_name']
$db_host = $resource['input']['db_host']
$db_port = $resource['input']['db_port']
$glance_api_servers_host = $resource['input']['glance_api_servers_host']
$glance_api_servers_port = $resource['input']['glance_api_servers_port']

$ensure_package            = $resource['input']['ensure_package']
$database_connection       = $resource['input']['database_connection']
$slave_connection          = $resource['input']['slave_connection']
$database_idle_timeout     = $resource['input']['database_idle_timeout']
$rpc_backend               = $resource['input']['rpc_backend']
$image_service             = $resource['input']['image_service']
$glance_api_servers        = $resource['input']['glance_api_servers']
$memcached_servers         = $resource['input']['memcached_servers']
$rabbit_host               = $resource['input']['rabbit_host']
$rabbit_hosts              = $resource['input']['rabbit_hosts']
$rabbit_password           = $resource['input']['rabbit_password']
$rabbit_port               = $resource['input']['rabbit_port']
$rabbit_userid             = $resource['input']['rabbit_userid']
$rabbit_virtual_host       = $resource['input']['rabbit_virtual_host']
$rabbit_use_ssl            = $resource['input']['rabbit_use_ssl']
$rabbit_ha_queues          = $resource['input']['rabbit_ha_queues']
$kombu_ssl_ca_certs        = $resource['input']['kombu_ssl_ca_certs']
$kombu_ssl_certfile        = $resource['input']['kombu_ssl_certfile']
$kombu_ssl_keyfile         = $resource['input']['kombu_ssl_keyfile']
$kombu_ssl_version         = $resource['input']['kombu_ssl_version']
$amqp_durable_queues       = $resource['input']['amqp_durable_queues']
$qpid_hostname             = $resource['input']['qpid_hostname']
$qpid_port                 = $resource['input']['qpid_port']
$qpid_username             = $resource['input']['qpid_username']
$qpid_password             = $resource['input']['qpid_password']
$qpid_sasl_mechanisms      = $resource['input']['qpid_sasl_mechanisms']
$qpid_heartbeat            = $resource['input']['qpid_heartbeat']
$qpid_protocol             = $resource['input']['qpid_protocol']
$qpid_tcp_nodelay          = $resource['input']['qpid_tcp_nodelay']
$auth_strategy             = $resource['input']['auth_strategy']
$service_down_time         = $resource['input']['service_down_time']
$log_dir                   = $resource['input']['log_dir']
$state_path                = $resource['input']['state_path']
$lock_path                 = $resource['input']['lock_path']
$verbose                   = $resource['input']['verbose']
$debug                     = $resource['input']['debug']
$periodic_interval         = $resource['input']['periodic_interval']
$report_interval           = $resource['input']['report_interval']
$rootwrap_config           = $resource['input']['rootwrap_config']
$use_ssl                   = $resource['input']['use_ssl']
$enabled_ssl_apis          = $resource['input']['enabled_ssl_apis']
$ca_file                   = $resource['input']['ca_file']
$cert_file                 = $resource['input']['cert_file']
$key_file                  = $resource['input']['key_file']
$nova_user_id              = $resource['input']['nova_user_id']
$nova_group_id             = $resource['input']['nova_group_id']
$nova_public_key           = $resource['input']['nova_public_key']
$nova_private_key          = $resource['input']['nova_private_key']
$nova_shell                = $resource['input']['nova_shell']
$monitoring_notifications  = $resource['input']['monitoring_notifications']
$use_syslog                = $resource['input']['use_syslog']
$log_facility              = $resource['input']['log_facility']
$install_utilities         = $resource['input']['install_utilities']
$notification_driver       = $resource['input']['notification_driver']
$notification_topics       = $resource['input']['notification_topics']
$notify_api_faults         = $resource['input']['notify_api_faults']
$notify_on_state_change    = $resource['input']['notify_on_state_change']
$mysql_module              = $resource['input']['mysql_module']
$nova_cluster_id           = $resource['input']['nova_cluster_id']
$sql_connection            = $resource['input']['sql_connection']
$sql_idle_timeout          = $resource['input']['sql_idle_timeout']
$logdir                    = $resource['input']['logdir']
$os_region_name            = $resource['input']['os_region_name']

class { 'nova':
  database_connection       => "mysql://${db_user}:${db_password}@${db_host}:${db_port}/${db_name}?charset=utf8",
  ensure_package            => $ensure_package,
  slave_connection          => $slave_connection,
  database_idle_timeout     => $database_idle_timeout,
  rpc_backend               => $rpc_backend,
  image_service             => $image_service,
  glance_api_servers        => "${glance_api_servers_host}:${glance_api_servers_port}",
  memcached_servers         => $memcached_servers,
  rabbit_host               => $rabbit_host,
  rabbit_hosts              => $rabbit_hosts,
  rabbit_password           => $rabbit_password,
  rabbit_port               => $rabbit_port,
  rabbit_userid             => $rabbit_userid,
  rabbit_virtual_host       => $rabbit_virtual_host,
  rabbit_use_ssl            => $rabbit_use_ssl,
  rabbit_ha_queues          => $rabbit_ha_queues,
  kombu_ssl_ca_certs        => $kombu_ssl_ca_certs,
  kombu_ssl_certfile        => $kombu_ssl_certfile,
  kombu_ssl_keyfile         => $kombu_ssl_keyfile,
  kombu_ssl_version         => $kombu_ssl_version,
  amqp_durable_queues       => $amqp_durable_queues,
  qpid_hostname             => $qpid_hostname,
  qpid_port                 => $qpid_port,
  qpid_username             => $qpid_username,
  qpid_password             => $qpid_password,
  qpid_sasl_mechanisms      => $qpid_sasl_mechanisms,
  qpid_heartbeat            => $qpid_heartbeat,
  qpid_protocol             => $qpid_protocol,
  qpid_tcp_nodelay          => $qpid_tcp_nodelay,
  auth_strategy             => $auth_strategy,
  service_down_time         => $service_down_time,
  log_dir                   => $log_dir,
  state_path                => $state_path,
  lock_path                 => $lock_path,
  verbose                   => $verbose,
  debug                     => $debug,
  periodic_interval         => $periodic_interval,
  report_interval           => $report_interval,
  rootwrap_config           => $rootwrap_config,
  use_ssl                   => $use_ssl,
  enabled_ssl_apis          => $enabled_ssl_apis,
  ca_file                   => $ca_file,
  cert_file                 => $cert_file,
  key_file                  => $key_file,
  nova_user_id              => $nova_user_id,
  nova_group_id             => $nova_group_id,
  nova_public_key           => $nova_public_key,
  nova_private_key          => $nova_private_key,
  nova_shell                => $nova_shell,
  monitoring_notifications  => $monitoring_notifications,
  use_syslog                => $use_syslog,
  log_facility              => $log_facility,
  install_utilities         => $install_utilities,
  notification_driver       => $notification_driver,
  notification_topics       => $notification_topics,
  notify_api_faults         => $notify_api_faults,
  notify_on_state_change    => $notify_on_state_change,
  mysql_module              => $mysql_module,
  nova_cluster_id           => $nova_cluster_id,
  sql_idle_timeout          => $sql_idle_timeout,
  logdir                    => $logdir,
  os_region_name            => $os_region_name,
}
